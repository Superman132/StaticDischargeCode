update code with the latest changes from the common code from patent pending code, there are and will be big fixes in
the code you share with william, so refresh this with all those changes. February 8th 2020